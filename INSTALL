$Id: INSTALL,v 1.2 2010/02/02 11:39:39 ak Exp $
                                                
  #### ##  ##  ##### ###### ##   ##     ##      
   ##  ### ## ###      ##  ####  ##     ##      
   ##  ######  ###     ## ##  ## ##     ##      
   ##  ## ###   ###    ## ###### ##     ##      
   ##  ##  ##    ###   ## ##  ## ##     ##      
  #### ##  ## #####    ## ##  ## ###### ######  
                                                
             How to install and use sendmail-virtualmailbox
--------------------------------------------------------------------------------
 * procmail delivers email to local user's Maildir (NOT virtual mailbox)
 * maildrop delivers email to virutal user's mailbox (NO unix account)
 * sendmail is installed into /usr/local/sendmail with MILTER
--------------------------------------------------------------------------------

 01. Add users and groups

      Add users and groups which are listed in the following files:
      example/etc-passwd, and example/etc-group .

--------------------------------------------------------------------------------
 02. Run configure script: 

      # ./configure

      Default values are:
        --prefix=/usr/local/sendmail
        --sendmail-user=sendmail
        --submit-user=smsubmit
        --virtualmailbox-user=virtmail
        --virtualmailbox-home=/home/virtmail
        --hostname=`hostname | cut -d. -f1`
        --domainname=`hostname | cut -d. -f2,3,4,5,6,7,8,9`

     If you want to install into another location, for example:

      # ./configure \
         --prefix=/usr/local/smmta \
         --sendmail-user=smmta \
         --submit-user=smmsp \
         --virtualmailbox-user=mail \
         --virtualmailbox-home=/var/spool/vmailbox

--------------------------------------------------------------------------------
 03. Run make command

      # make && make install
      
      After you run ``make'', procmail, maildrop, heirloom-mailx, sendmail, and
      sid-milter are automatically downloaded and built.

--------------------------------------------------------------------------------
 04. Install sendmail.cf and sendmail.mc

      # make install-cf

      ``make'' create sendmail.mc and sendmail.cf at ./build directory.
      When you run ``make install-cf'', ./build/sendmail.(cf|mc) are installed
      into /usr/local/sendmail/etc/ and existing sendmail.cf will be copied as
      sendmail.cf.bak .

      sendmail.mc and sendmail.cf in ./build directory are also installed into
      /usr/local/sendmail/share/cf/cf as `hostname`.(mc|cf)

--------------------------------------------------------------------------------
 05. Edit configuration files

      Edit virtuser-domains, virtusertable, and other sendmail configuration
      files in /usr/local/sendmail/etc directory.

      If you want to change sendmail.cf, edit sendmail.mc in /usr/local/sendmail
      /etc/ directory and run ``make sendmail.cf'', or edit `hostname`.mc in 
      /usr/local/sendmail/share/cf/cf/ directory and run ``make `hostname`.cf''.

--------------------------------------------------------------------------------
 06. Create local user's mailbox

      Create local user's mailbox(Maildir/) like following:
      # mkdir -pm 0700 /root/Maildir/{cur,new,tmp}
      # mkdir -pm 0700 /home/fuga/Maildir/{cur,new,tmp}

      OR

      # mkdir -pm 0700 /etc/skel/Maildir/{cur,new,tmp}
      # adduser bar

--------------------------------------------------------------------------------
 07. Create virtual user's mailbox

      Virtual user's mailbox directory is /home/virtmail by default. 
      /usr/local/sendmail/sbin/make-vmailbox script is useful to create virtual
      mailbox like the following:

      # make-vmailbox hoge@example.jp foo@example.org
      # find /home/virtmail -type d
      /home/virtmail/
      /home/virtmail/example.jp
      /home/virtmail/example.jp/hoge
      /home/virtmail/example.jp/hoge/Maildir
      /home/virtmail/example.jp/hoge/Maildir/tmp
      /home/virtmail/example.jp/hoge/Maildir/new
      /home/virtmail/example.jp/hoge/Maildir/cur
      /home/virtmail/example.org/foo
      /home/virtmail/example.org/foo/Maildir
      /home/virtmail/example.org/foo/Maildir/tmp
      /home/virtmail/example.org/foo/Maildir/new
      /home/virtmail/example.org/foo/Maildir/cur
      

--------------------------------------------------------------------------------
 08. Setup dovecot or other IMAP/POP3 Server program

      See example/dovecot-* files to install and configure dovecot.

--------------------------------------------------------------------------------
 08. Start Milter programs if you use
     
      Start milter programs, ( e.g. sid-milter, clamav-milter, and so on) before
      starting sendmail. Helper script /usr/local/sendmail/sbin/sidctl is useful
      to start/stop sid-milter.

      Dont forget enable a milter configuration in sendmail.cf.
      # grep MILTER sendmail.cf

--------------------------------------------------------------------------------
 09. Start sendmail

      There are 3 ways to start sendmail daemon
      a) /usr/local/sendmail/sbin/sendmail -bd -q5m -Lsm-mta
      b) /usr/local/sendmail/sbin/sendmailctl start
      c) /usr/local/sbin/smctl start

      smctl is a symbolic link to sendmailctl command. If you use sendmailctl or
      smctl command, Edit daemon-options and queue-interval file in /usr/local/
      sendmail/etc directory.

--------------------------------------------------------------------------------
